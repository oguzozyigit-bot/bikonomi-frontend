<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Caynana AI â€“ Chat</title>

<style>
:root{
  --bg:#0e0e0e;
  --panel:#141414;
  --border:rgba(255,255,255,.1);
  --text:#ececec;
}
body{
  margin:0;
  background:#000;
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:720px; /* ChatGPT hissi */
  height:100dvh;
  display:flex;
  flex-direction:column;
  background:var(--bg);
}
header{
  padding:12px 16px;
  border-bottom:1px solid var(--border);
  font-weight:700;
}
#chat{
  flex:1;
  overflow:auto;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.bubble{
  max-width:80%;
  padding:10px 14px;
  border-radius:14px;
  line-height:1.4;
  white-space:pre-wrap;
}
.user{align-self:flex-end;background:#1e1e1e}
.bot{align-self:flex-start;background:var(--panel);border:1px solid var(--border)}
.composer{
  display:flex;
  gap:8px;
  padding:12px;
  border-top:1px solid var(--border);
  align-items:flex-end;
}
.composer textarea{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#111;
  color:var(--text);
  resize:none;
  overflow:hidden;
  min-height:44px;
  max-height:160px;
  line-height:1.4;
}
.btn{
  padding:10px 12px;
  border-radius:12px;
  background:#111;
  border:1px solid var(--border);
  color:var(--text);
  cursor:pointer;
}
</style>
</head>

<body>
<div class="app">

<header>Caynana AI</header>

<div id="chat"></div>

<div class="composer">
  <input type="file" id="fileInput" multiple style="display:none" />
  <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none" />

  <button class="btn" id="fileBtn">ğŸ“</button>
  <button class="btn" id="cameraBtn">ğŸ“·</button>
  <button class="btn" id="micBtn">ğŸ™ï¸</button>

  <textarea id="msgInput" placeholder="Bir ÅŸey sorâ€¦"></textarea>
  <button class="btn" id="sendBtn">â¤</button>
</div>

</div>

<script type="module">
import { fetchTextResponse, addUserBubble, typeWriter } from "/js/chat.js";
import { ChatStore } from "/js/chat_store.js";

const chatEl = document.getElementById("chat");
const input = document.getElementById("msgInput");

ChatStore.load(chatEl);

// textarea auto-grow
input.addEventListener("input", ()=>{
  input.style.height = "auto";
  input.style.height = input.scrollHeight + "px";
});

async function send(){
  const text = input.value.trim();
  if(!text) return;

  addUserBubble(text);
  ChatStore.add("user", text);
  input.value="";
  input.style.height="auto";

  const res = await fetchTextResponse(text,"chat",ChatStore.history());
  typeWriter(res.text);
  ChatStore.add("assistant",res.text);
}

document.getElementById("sendBtn").onclick = send;

input.addEventListener("keydown", e=>{
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault();
    send();
  }
});

// Mikrofon â†’ yazÄ±ya Ã§evir
let rec;
document.getElementById("micBtn").onclick = ()=>{
  if(!window.SpeechRecognition && !window.webkitSpeechRecognition){
    alert("TarayÄ±cÄ± desteklemiyor");return;
  }
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  rec = new SR();
  rec.lang="tr-TR";
  rec.onresult=e=> input.value += (input.value ? " " : "") + e.results[0][0].transcript;
  rec.start();
};

// Dosya / Foto
document.getElementById("fileBtn").onclick = ()=> fileInput.click();
document.getElementById("cameraBtn").onclick = ()=> cameraInput.click();

fileInput.onchange = e=>{
  [...e.target.files].forEach(f=>{
    addUserBubble("ğŸ“ Dosya eklendi: " + f.name);
    ChatStore.add("user","[DOSYA] " + f.name);
  });
};
cameraInput.onchange = e=>{
  if(e.target.files[0]){
    addUserBubble("ğŸ“· FotoÄŸraf eklendi");
    ChatStore.add("user","[FOTO] KullanÄ±cÄ± fotoÄŸraf yÃ¼kledi");
  }
};
</script>

</body>
</html>

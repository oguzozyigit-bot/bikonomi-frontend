<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Caynana AI - Giriş</title>

  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/css/style.css?v=2">

  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    /* =========================================
       LOGIN SAYFASI ÖZEL CSS
       ========================================= */
    :root {
      --gold: #ffb300;
      --bg-dark: #050505;
    }

    body {
      background: var(--bg-dark);
      color: #eee;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      overflow: hidden; /* Scroll yok */
    }

    /* Çerçeve */
    .mobile-frame {
      width: 100%; height: 100%; max-width: 480px; margin: 0 auto;
      background: #0e0e0e; display: flex; flex-direction: column;
      position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5);
    }

    /* Üst Bar (Logo) */
    .topbar {
      height: 140px; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding-top: 40px;
    }
    
    .seesaw-svg { width: 60px; height: 30px; overflow: visible; }
    .seesaw-bar { animation: rock 4s ease-in-out infinite; transform-origin: 20px 8px; }
    @keyframes rock { 0%,100%{transform:rotate(-6deg)} 50%{transform:rotate(6deg)} }

    .brand-name { font-size: 24px; font-weight: 900; color: #fff; margin-top: 10px; letter-spacing: 0.5px; }
    .slogan { font-size: 11px; color: #888; font-weight: 600; margin-top: 4px; opacity: 0.8; }

    /* Orta Alan (Butonlar) */
    .login-page {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center; gap: 16px;
      padding: 0 20px 100px;
    }

    .login-lead { font-size: 13px; font-weight: 900; color: rgba(255,255,255,0.7); margin-bottom: 10px; }

    /* 3D Butonlar */
    .btn-3d {
      width: 100%; height: 56px; border-radius: 18px; border: none;
      font-weight: 800; font-size: 15px; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.15);
      transition: transform 0.1s ease, filter 0.1s ease; user-select: none;
      position: relative; overflow: hidden;
    }
    .btn-3d:active { transform: translateY(2px); filter: brightness(0.95); box-shadow: 0 5px 15px rgba(0,0,0,0.4); }

    /* Google Butonu */
    .btn-google {
      background: linear-gradient(135deg, #4285F4, #2b6fe8); color: #fff;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .gmark {
      width: 24px; height: 24px; background: #fff; border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      color: #4285F4; font-weight: 900; font-size: 16px;
    }

    /* Google Iframe Katmanı */
    .google-wrap { position: relative; width: 100%; max-width: 380px; height: 56px; }
    #googleBtnWrap {
      position: absolute; inset: 0; z-index: 10; opacity: 0.01; cursor: pointer;
    }
    #googleBtnWrap iframe { width: 100% !important; height: 100% !important; }

    /* Apple Butonu */
    .btn-apple {
      background: linear-gradient(135deg, #1a1a1a, #000); color: #ccc;
      border: 1px solid rgba(255,255,255,0.15); max-width: 380px;
    }
    .amark { font-size: 20px; line-height: 1; color: #fff; }

    /* Alt Bar (Links) */
    .login-footerbar {
      position: absolute; bottom: 0; left: 0; width: 100%;
      background: rgba(0,0,0,0.9); border-top: 1px solid rgba(255,255,255,0.08);
      padding: 15px 0 25px; display: flex; flex-direction: column; gap: 10px;
      align-items: center; z-index: 100;
    }
    .login-links { display: flex; gap: 15px; font-size: 11px; font-weight: 700; }
    .login-links a { color: rgba(255,255,255,0.6); text-decoration: none; }
    .login-brand { font-size: 10px; color: rgba(255,255,255,0.3); font-weight: 600; }

    /* Sözleşme Overlay */
    .full-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999;
      display: none; align-items: center; justify-content: center; padding: 20px;
    }
    .full-overlay.active { display: flex; }

    .terms-card {
      width: 100%; max-width: 480px; background: #121212;
      border: 1px solid rgba(255,255,255,0.1); border-radius: 24px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.8); overflow: hidden;
      display: flex; flex-direction: column; max-height: 80vh;
    }
    .terms-head {
      padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex; justify-content: space-between; align-items: center;
      color: #fff; font-weight: 800; font-size: 14px;
    }
    .x-btn {
      width: 32px; height: 32px; background: rgba(255,255,255,0.1);
      border: none; border-radius: 8px; color: #fff; font-size: 18px; cursor: pointer;
    }
    #termsFrame { flex: 1; border: none; background: #fff; width: 100%; min-height: 0; }
    
    .agreement { padding: 16px; display: flex; flex-direction: column; gap: 12px; }
    .agree-row { display: flex; align-items: center; gap: 10px; font-size: 13px; color: #ccc; font-weight: 600; }
    .agree-row input { width: 18px; height: 18px; accent-color: var(--gold); }
    
    #termsAcceptBtn {
      width: 100%; height: 50px; border-radius: 14px; border: none;
      background: var(--gold); color: #000; font-weight: 900; font-size: 14px;
      cursor: pointer; opacity: 0.5; pointer-events: none; transition: opacity 0.2s;
    }
    #termsAcceptBtn.enabled { opacity: 1; pointer-events: auto; }

  </style>
</head>

<body>

<div class="mobile-frame">

  <div class="topbar">
    <svg class="seesaw-svg" viewBox="0 0 40 20">
      <g class="seesaw-bar">
        <line x1="0" y1="8" x2="40" y2="8" stroke="#777" stroke-width="2" stroke-linecap="round" />
        <circle cx="3" cy="5" r="3" fill="#bef264" />
        <circle cx="37" cy="5" r="3" fill="#ffb300" />
      </g>
      <polygon points="17,14 23,14 20,8" fill="#444" />
    </svg>
    <div class="brand-name">Caynana.AI</div>
    <div class="slogan">Yapay Zekânın Geleneksel Aklı</div>
  </div>

  <div class="login-page">
    <div class="login-lead">Üyelik Ücretsizdir.</div>

    <div class="google-wrap">
      <button class="btn-3d btn-google">
        <span class="gmark">G</span> Google ile Devam Et
      </button>
      <div id="googleBtnWrap"></div>
    </div>

    <button class="btn-3d btn-apple" id="appleLoginBtn">
      <span class="amark"></span> Apple ile Devam Et
    </button>
  </div>

  <div class="login-footerbar">
    <div class="login-links">
      <a href="/pages/hakkimizda.html">Hakkımızda</a>
      <a href="/pages/sss.html">SSS</a>
      <a href="/pages/gizlilik.html">Gizlilik</a>
      <a href="/pages/iletisim.html">İletişim</a>
    </div>
    <div class="login-brand">@CaynanaAI By Ozyigit’s 2026</div>
  </div>

</div>

<div class="full-overlay" id="termsOverlay">
  <div class="terms-card">
    <div class="terms-head">
      <span>Kullanıcı Sözleşmesi</span>
      <button id="closeTermsBtn" class="x-btn">×</button>
    </div>
    
    <iframe id="termsFrame" src="/pages/sozlesme.html"></iframe>

    <div class="agreement">
      <div class="agree-row">
        <input type="checkbox" id="termsCheck">
        <label for="termsCheck">Okudum ve onaylıyorum.</label>
      </div>
      <button id="termsAcceptBtn">ONAYLA VE GİRİŞ YAP</button>
    </div>
  </div>
</div>

<script type="module">
  import { STORAGE_KEY } from "/js/config.js";
  import { initAuth, acceptTerms, logout } from "/js/auth.js";

  const $ = (id) => document.getElementById(id);
  function safeJson(s, fb={}){ try{ return JSON.parse(s||""); }catch{ return fb; } }
  function termsKey(email=""){ return `caynana_terms_accepted_at::${String(email||"").toLowerCase().trim()}`; }

  // 1. Durum Kontrolü
  function checkStatus(){
    const u = safeJson(localStorage.getItem(STORAGE_KEY), {});
    
    // Kullanıcı varsa
    if(u && u.email && u.isSessionActive){
      const email = String(u.email).toLowerCase().trim();
      const accepted = localStorage.getItem(termsKey(email));

      if(accepted) {
        // Her şey tamamsa Chat'e git
        window.location.replace("/pages/chat.html");
      } else {
        // Sözleşme eksikse aç
        openTerms();
      }
    } else {
      // Kimse yoksa Google'ı hazırla
      initAuth();
    }
  }

  // 2. Sözleşme Yönetimi
  const termsOverlay = $("termsOverlay");
  const termsCheck = $("termsCheck");
  const termsBtn = $("termsAcceptBtn");

  function openTerms(){ termsOverlay.classList.add("active"); }
  function closeTerms(){ termsOverlay.classList.remove("active"); }

  termsCheck.addEventListener("change", () => {
    if(termsCheck.checked) termsBtn.classList.add("enabled");
    else termsBtn.classList.remove("enabled");
  });

  termsBtn.addEventListener("click", async () => {
    if(!termsCheck.checked) return;
    const ok = await acceptTerms();
    if(ok) window.location.replace("/pages/chat.html");
  });

  $("closeTermsBtn").addEventListener("click", () => {
    closeTerms();
    logout(); // Vazgeçerse çıkış yap
  });

  // 3. Diğer Butonlar
  $("appleLoginBtn").addEventListener("click", () => {
    alert("Apple girişi yakında! Şimdilik Google'ı kullanın.");
  });

  // Başlat
  checkStatus();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caynana</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .card{transition:transform .15s ease, box-shadow .15s ease}
    .card:hover{transform:translateY(-2px); box-shadow:0 16px 40px rgba(0,0,0,.06)}
    .line-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .line-4{display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden}
  </style>
</head>

<body class="bg-white text-slate-900">

<!-- HEADER / GLOBAL SEARCH -->
<header class="sticky top-0 z-40 bg-white/95 backdrop-blur border-b border-slate-200">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
    <div class="flex items-center gap-2">
      <div class="w-9 h-9 rounded-xl border border-slate-200 flex items-center justify-center font-extrabold">
        C
      </div>
      <div>
        <div class="font-extrabold tracking-tight leading-5">Caynana</div>
        <div class="text-xs text-slate-500 -mt-0.5">Alışverişte son söz</div>
      </div>
    </div>

    <div class="flex-1">
      <div class="flex items-center gap-2 bg-slate-100 border border-slate-200 rounded-full px-4 py-2">
        <i class="fa-solid fa-magnifying-glass text-slate-400"></i>
        <input id="q" type="text"
          class="w-full bg-transparent outline-none text-sm"
          placeholder="Ürün adı yaz veya link yapıştır…"
          autocomplete="off"
        />
      </div>
    </div>

    <button id="btnSearch"
      class="px-4 py-2 rounded-full bg-slate-900 text-white font-semibold hover:opacity-90">
      Caynana’ya Sor
    </button>
  </div>
</header>

<!-- MAIN -->
<main class="max-w-6xl mx-auto px-4 py-8">

  <!-- HERO -->
  <section class="text-center mb-10">
    <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">
      Almadan önce Caynana’ya sor.
    </h1>
    <p class="mt-3 text-slate-500">
      Fiyatı, yorumu ve riski tartar. Net konuşur.
    </p>
    <p class="mt-1 text-xs text-slate-400">Akıllı analizle.</p>
  </section>

  <!-- STATUS -->
  <div id="status"
       class="hidden mb-6 px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-sm text-slate-600">
  </div>

  <!-- RESULTS -->
  <section>
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-extrabold tracking-tight">Caynana Önerileri</h2>
      <div id="meta" class="text-xs text-slate-500"></div>
    </div>

    <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

    <div id="empty" class="hidden text-center text-slate-400 py-16">
      Bir şey ara, Caynana konuşsun.
    </div>
  </section>

  <!-- TRENDING -->
  <section class="mt-12 border-t border-slate-200 pt-8">
    <h3 class="text-sm font-extrabold tracking-wide uppercase">
      Bugün Caynana’ya En Çok Sorulanlar
    </h3>
    <p class="text-xs text-slate-500 mt-1">Kullanıcılar şu an ne arıyor?</p>

    <div class="mt-4 flex gap-3 overflow-x-auto">
      <span class="px-4 py-2 rounded-full border border-slate-200 bg-slate-50 text-sm whitespace-nowrap">samsung a07</span>
      <span class="px-4 py-2 rounded-full border border-slate-200 bg-slate-50 text-sm whitespace-nowrap">robot süpürge</span>
      <span class="px-4 py-2 rounded-full border border-slate-200 bg-slate-50 text-sm whitespace-nowrap">airfryer 5.5 lt</span>
      <span class="px-4 py-2 rounded-full border border-slate-200 bg-slate-50 text-sm whitespace-nowrap">kulaklık anc</span>
    </div>
  </section>

</main>

<!-- FOOTER -->
<footer class="mt-16 border-t border-slate-200 py-6 text-center text-xs text-slate-500">
  Caynana, veriye dayalı <strong>akıllı analiz</strong> kullanır. Amacı satmak değil, korumaktır.
</footer>

<!-- SCRIPT -->
<script>
  const API_BASE = "https://bikonomi-api-1.onrender.com";

  const qEl = document.getElementById("q");
  const btn = document.getElementById("btnSearch");
  const grid = document.getElementById("grid");
  const empty = document.getElementById("empty");
  const statusEl = document.getElementById("status");
  const metaEl = document.getElementById("meta");

  function showStatus(txt){
    statusEl.textContent = txt;
    statusEl.classList.remove("hidden");
  }
  function hideStatus(){
    statusEl.classList.add("hidden");
  }

  function escapeHtml(s){
    return String(s ?? "")
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;");
  }

  function card(p){
    const badge = p.platform?.label || "Diğer";
    const rating = p.rating ? `★ ${p.rating}` : "Puan yok";
    return `
      <div class="card bg-white border border-slate-200 rounded-2xl p-4">
        <img src="${p.image || "https://placehold.co/600x600"}"
             class="w-full h-40 object-contain bg-slate-50 rounded-xl mb-3" />

        <div class="font-bold text-sm line-2">${escapeHtml(p.title)}</div>

        <div class="mt-2 text-lg font-extrabold">${p.price || "Fiyat yok"}</div>

        <div class="mt-2 flex flex-wrap gap-2 text-xs text-slate-500">
          <span class="px-2 py-1 rounded-full border">${badge}</span>
          <span class="px-2 py-1 rounded-full border">${rating}</span>
        </div>

        ${p.aiComment ? `
          <div class="mt-3 p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm line-4">
            ${escapeHtml(p.aiComment)}
          </div>` : ``}

        <div class="mt-4 flex gap-2">
          <a href="${p.url}" target="_blank"
             class="flex-1 text-center px-3 py-2 rounded-xl bg-slate-900 text-white font-semibold">
            Ürüne Git
          </a>
          <button class="flex-1 px-3 py-2 rounded-xl border border-slate-300 font-semibold">
            Caynana’nın Yorumu
          </button>
        </div>
      </div>
    `;
  }

  async function search(){
    const q = qEl.value.trim();
    if(!q) return;

    grid.innerHTML = "";
    empty.classList.add("hidden");
    showStatus("Caynana bakıyor…");

    try{
      const r = await fetch(API_BASE + "/api/search?q=" + encodeURIComponent(q));
      const j = await r.json();

      hideStatus();

      if(j.error){
        showStatus(j.message || "Bir hata oluştu.");
        return;
      }

      const products = j.products || [];
      metaEl.textContent = `İncelenen: ${j.examined} • Dönen: ${j.returned}`;

      if(!products.length){
        empty.classList.remove("hidden");
        return;
      }

      grid.innerHTML = products.map(card).join("");
    }catch(e){
      showStatus("Bağlantı sorunu.");
    }
  }

  btn.addEventListener("click", search);
  qEl.addEventListener("keydown", e => { if(e.key === "Enter") search(); });
</script>

</body>
</html>

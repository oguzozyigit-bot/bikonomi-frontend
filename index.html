<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content" />
<title>Caynana AI v2.8 (Stand-Alone)</title>
<link rel="icon" href="data:,">
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
  /* --- CSS --- */
  :root { --bg-outer: #000; --bg: #0e0e0e; --text: #ececec; --gold: #ffb300; --pistachio: #bef264; --glass: rgba(20, 20, 20, 0.98); --border: rgba(255, 255, 255, 0.12); --lip-color: #d84315; --card-bg: #1a1a1a; }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; background: var(--bg-outer); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; color: var(--text); overflow: hidden; display: flex; align-items: center; justify-content: center; }
  
  .mobile-frame { width: 100%; height: 100%; max-width: 480px; background: var(--bg); position: relative; display: flex; flex-direction: column; box-shadow: 0 0 50px rgba(255, 255, 255, 0.05); overflow: hidden; }
  @media (min-width: 500px) { .mobile-frame { height: 95dvh; border-radius: 24px; border: 1px solid #333; } }

  /* HEADER */
  .topbar { flex: 0 0 75px; background: var(--glass); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 16px; z-index: 3000; }
  .hamb-btn { background: none; border: none; cursor: pointer; color: #aaa; font-size: 24px; padding: 0; }
  
  .brand-wrapper { display: flex; flex-direction: column; align-items: center; margin-right: 40px; flex: 1; transition: transform 0.4s; }
  .logo-area { display: flex; align-items: center; gap: 8px; }
  .brand-name { font-weight: 700; font-size: 16px; color: #fff; }
  .slogan { font-size: 11px; color: #888; margin-top: 2px; } 
  
  .seesaw-svg { width: 36px; height: 18px; overflow: visible; }
  .seesaw-bar { transform-origin: 20px 8px; transition: transform 0.4s; }
  .brand-wrapper.talking .seesaw-bar { animation: talkWiggle 0.4s infinite alternate ease-in-out; }
  @keyframes talkWiggle { from { transform: rotate(-12deg); } to { transform: rotate(12deg); } }
  .brand-wrapper.thinking #orangeBall { animation: breathAnim 0.8s infinite alternate ease-in-out; transform-box: fill-box; transform-origin: center; }
  @keyframes breathAnim { from { transform: scale(1); filter: brightness(1); } to { transform: scale(1.5); filter: brightness(1.3); box-shadow: 0 0 10px var(--gold); } }

  /* MENU & OVERLAY */
  .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 5000; opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(5px); display:flex; justify-content: flex-start;}
  .menu-overlay.open { opacity: 1; pointer-events: auto; }
  .menu-sidebar { width: 270px; height: 100%; background: #161616; padding: 20px; transform: translateX(-100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; border-right: 1px solid #333; }
  .menu-overlay.open .menu-sidebar { transform: translateX(0); }
  
  .menu-item { color: #888; text-decoration: none; padding: 12px 0; display: block; font-size: 14px; border-bottom: 1px solid #222; cursor: pointer; }
  .menu-item:hover { color: var(--gold); }

  /* CHAT */
  .chat-area { flex: 1; overflow-y: auto; padding: 20px 16px; display: flex; flex-direction: column; gap: 16px; }
  .bubble { max-width: 85%; padding: 12px 14px; border-radius: 18px; font-size: 15px; line-height: 1.4; word-wrap: break-word; }
  .bubble.bot { align-self: flex-start; background: #1c1c1c; border-left: 3px solid var(--gold); color: #ddd; border-top-left-radius: 4px; }
  .bubble.user { align-self: flex-end; background: #222; border-right: 3px solid var(--pistachio); color: #fff; border-top-right-radius: 4px; text-align: right; }

  /* INPUT */
  .input-dock { flex: 0 0 auto; background: var(--glass); padding: 10px 16px 20px; z-index: 3000; border-top: 1px solid var(--border); }
  .dock-inner { display: flex; align-items: flex-end; gap: 8px; background: #1a1a1a; border: 1px solid #333; border-radius: 24px; padding: 6px; }
  .icon-btn { width: 42px; height: 42px; border-radius: 50%; border: none; background: transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; }
  .icon-btn svg { width: 22px; height: 22px; stroke: #aaa; stroke-width: 2; fill: none; }
  .send-btn { width: 42px; height: 42px; border-radius: 50%; background: var(--pistachio); border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; }
  textarea { flex: 1; background: transparent; border: none; outline: none; color: #fff; font-size: 16px; resize: none; padding: 10px; max-height: 100px; }

  /* G√ñZLER */
  .face-container { height: 0; overflow: hidden; transition: 0.5s; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #0e0e0e; }
  .mobile-frame.tracking-active .face-container { height: 180px; border-bottom: 1px solid #333; }
  .eyes-row { display: flex; gap: 24px; margin-bottom: 10px; }
  .eye { width: 90px; height: 65px; position: relative; --gx:0px; --gy:0px; }
  .sclera { width: 100%; height: 100%; background: #e0e0e0; border-radius: 50%; overflow: hidden; position: relative; border: 2px solid #1a1a1a; }
  .iris { width: 32px; height: 32px; background: #3e2723; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(calc(-50% + var(--gx)), calc(-50% + var(--gy))); }
  .pupil { width: 10px; height: 10px; background: #000; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
  
  /* LOGIN OVERLAY */
  .full-overlay { position: absolute; inset: 0; background: #000; z-index: 6000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.4s; }
  .full-overlay.hidden { opacity: 0; pointer-events: none; }
  .auth-btn { padding: 12px 24px; border-radius: 12px; border: 1px solid #333; background: #fff; color: #000; font-weight: bold; cursor: pointer; margin-top: 20px; }
</style>
</head>
<body>

<div class="mobile-frame" id="mobileFrame">

  <div class="full-overlay" id="loginOverlay">
    <div class="brand-wrapper thinking" style="transform: scale(1.5); margin-bottom: 20px;">
        <svg class="seesaw-svg" viewBox="0 0 40 20">
          <g class="seesaw-bar"><line x1="0" y1="8" x2="40" y2="8" stroke="#ccc" stroke-width="2"/><circle cx="37" cy="5" r="3" fill="#ffb300" id="orangeBall"/></g>
        </svg>
    </div>
    <h2 style="color:#fff;">Caynana AI</h2>
    <p style="color:#888; font-size: 13px;">Yapay Zek√¢nƒ±n Geleneksel Aklƒ±</p>
    <button class="auth-btn" onclick="startApp()">Giri≈ü Yap (Misafir)</button>
  </div>

  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-sidebar">
      <h3 style="color:#fff; border-bottom:1px solid #333; padding-bottom:10px;">Men√º</h3>
      <a class="menu-item" onclick="window.location.reload()">üîÑ Yenile</a>
      <a class="menu-item" onclick="toggleCam()">üëÅÔ∏è G√∂z Takibi A√ß/Kapat</a>
      <a class="menu-item" style="color:#ff5252" onclick="window.location.reload()">üö™ √áƒ±kƒ±≈ü</a>
      <div style="margin-top:auto; color:#666; font-size:10px; text-align:center;">v2.8 Standalone</div>
    </div>
  </div>

  <div class="topbar">
    <button class="hamb-btn" id="hambBtn">‚ò∞</button>
    <div class="brand-wrapper" id="brandWrapper">
      <div class="logo-area">
        <div class="brand-name">Caynana AI</div>
      </div>
      <div class="slogan">Online</div>
    </div>
    <div style="width: 24px;"></div> </div>

  <div class="face-container" id="faceContainer">
    <div class="eyes-row">
      <div class="eye" id="eyeL"><div class="sclera"><div class="iris"><div class="pupil"></div></div></div></div>
      <div class="eye" id="eyeR"><div class="sclera"><div class="iris"><div class="pupil"></div></div></div></div>
    </div>
  </div>

  <div class="chat-area" id="chat"></div>

  <div class="input-dock">
    <div class="dock-inner">
      <button class="icon-btn" onclick="toggleCam()">üëÅÔ∏è</button>
      <textarea id="msgInput" rows="1" placeholder="Ne lazƒ±m evladƒ±m?"></textarea>
      <button class="send-btn" id="sendBtn"><svg viewBox="0 0 24 24" width="20" height="20" stroke="#000" fill="none"><path d="M22 2L11 13"></path><path d="M22 2L15 22L11 13L2 9L22 2Z"></path></svg></button>
    </div>
  </div>

</div>

<script>
  // --- AYARLAR ---
  // Buraya kendi Backend URL'ini yaz (sonunda / olmasƒ±n)
  const BASE_DOMAIN = "https://caynana-api-py310-final.onrender.com"; 
  let chatHistory = [];

  // --- SE√áƒ∞Cƒ∞LER ---
  const $ = (id) => document.getElementById(id);

  // --- 1. MEN√ú A√áMA / KAPAMA (GARANTƒ∞) ---
  const menuOverlay = $('menuOverlay');
  const hambBtn = $('hambBtn');

  // Butona basƒ±nca √ßalƒ±≈üacak fonksiyon
  function toggleMenu() {
    console.log("Men√º butonuna basƒ±ldƒ±");
    menuOverlay.classList.toggle('open');
  }

  // Event Listener Ekleme
  if(hambBtn) {
    hambBtn.onclick = toggleMenu; // En basit ve garanti y√∂ntem
  }
  
  if(menuOverlay) {
    menuOverlay.onclick = (e) => {
        if(e.target === menuOverlay) toggleMenu();
    }
  }

  // --- 2. UYGULAMA BA≈ûLATMA ---
  window.startApp = function() {
    $('loginOverlay').classList.add('hidden');
    setTimeout(() => {
        typeWriter("Ho≈ü geldin evladƒ±m. Ben Caynana. Ne istiyorsun s√∂yle bakalƒ±m?");
    }, 500);
  }

  // --- 3. MESAJLA≈ûMA (Chat Bubble Ekleme) ---
  function addUserBubble(text) {
    const chatDiv = $('chat');
    const bubble = document.createElement("div");
    bubble.className = "bubble user";
    bubble.textContent = text;
    chatDiv.appendChild(bubble);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  }

  window.typeWriter = function(text) {
    const chatDiv = $('chat');
    const brand = $('brandWrapper');
    if(brand) brand.classList.add('talking');

    const bubble = document.createElement("div");
    bubble.className = "bubble bot";
    chatDiv.appendChild(bubble);

    let i = 0;
    function type() {
      if (i < text.length) {
        bubble.textContent += text.charAt(i);
        i++;
        chatDiv.scrollTop = chatDiv.scrollHeight;
        setTimeout(type, 20);
      } else {
        if(brand) brand.classList.remove('talking');
      }
    }
    type();
  };

  // --- 4. BACKEND ƒ∞LE KONU≈ûMA ---
  async function sendMessage() {
    const inputEl = $('msgInput');
    const txt = inputEl.value.trim();
    if(!txt) return;

    addUserBubble(txt);
    inputEl.value = '';
    
    // Hafƒ±za
    chatHistory.push({ role: "user", content: txt });

    const brand = $('brandWrapper');
    if(brand) brand.classList.add('thinking');

    try {
        // Backend'e istek at
        const res = await fetch(`${BASE_DOMAIN}/api/chat`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                text: txt,
                user_id: "misafir_html",
                history: chatHistory
            })
        });

        const data = await res.json();
        if(brand) brand.classList.remove('thinking');

        if(data && data.text) {
            typeWriter(data.text);
            chatHistory.push({ role: "assistant", content: data.text });
        }
    } catch(e) {
        console.error("Hata:", e);
        if(brand) brand.classList.remove('thinking');
        typeWriter("ƒ∞nternetim √ßekmiyor evladƒ±m, fi≈üi takƒ±lƒ± mƒ±?");
    }
  }

  // G√∂nder butonu
  $('sendBtn').onclick = sendMessage;
  $('msgInput').onkeydown = (e) => {
      if(e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
      }
  };

  // --- 5. G√ñZ TAKƒ∞P ANƒ∞MASYONU ---
  window.toggleCam = function() {
    $('mobileFrame').classList.toggle('tracking-active');
  }

  document.addEventListener('mousemove', (e) => {
    const frame = $('mobileFrame');
    if(!frame.classList.contains('tracking-active')) return;

    const rect = frame.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
    const y = ((e.clientY - rect.top) / rect.height) * 2 - 1;

    const eyeL = $('eyeL');
    const eyeR = $('eyeR');
    
    const gx = Math.min(Math.max(x * 20, -20), 20);
    const gy = Math.min(Math.max(y * 15, -15), 15);

    [eyeL, eyeR].forEach(eye => {
        eye.style.setProperty('--gx', gx + 'px');
        eye.style.setProperty('--gy', gy + 'px');
    });
  });

  console.log("Caynana v2.8 Standalone Hazƒ±r.");
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Caynana AI v5.2 FINAL</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/css/style.css?v=1">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

<div class="mobile-frame" id="mobileFrame">
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="left-controls">
      <button class="hamb-btn" id="hambBtn">â˜°</button>
    </div>

    <div class="brand-wrapper" id="brandWrapper">
      <div class="logo-area">
        <div class="brand-name">Caynana AI</div>
      </div>
      <div class="slogan">Yapay ZekÃ¢nÄ±n Geleneksel AklÄ±</div>
    </div>

    <div class="right-controls">
      <button class="icon-btn-top" id="profileBtn">ğŸ‘¤</button>
    </div>
  </div>

  <!-- MENU -->
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-sidebar">

      <button class="new-chat-btn" id="newChatBtn">
        <span>+</span> YENÄ° SOHBET BAÅLAT
      </button>

      <div class="section-title">SOHBETLER</div>
      <div class="history-list" id="historyList"></div>

      <div class="menu-footer-actions">
        <a class="action-link" id="logoutBtn">ğŸ›¡ï¸ GÃ¼venli Ã‡Ä±kÄ±ÅŸ</a>
        <a class="action-link delete-acc" id="deleteAccountBtn">ğŸ—‘ï¸ HesabÄ±mÄ± Sil</a>
        <div class="footer-copy">@CaynanaAI By Ozyigits 2026</div>
      </div>
    </div>
  </div>

  <!-- CHAT -->
  <div class="chat-area" id="chat"></div>

  <!-- INPUT -->
  <div class="input-dock">
    <div class="dock-inner">
      <textarea id="msgInput" rows="1" placeholder="Ne lazÄ±m evladÄ±m?"></textarea>
      <button class="send-btn" id="sendBtn">â¤</button>
    </div>
  </div>
</div>

<script type="module">
import { fetchTextResponse, addUserBubble, typeWriter } from "/js/chat.js";
import { ChatStore } from "/js/chat_store.js";

const chatEl = document.getElementById("chat");
const input = document.getElementById("msgInput");
const historyList = document.getElementById("historyList");

// INIT
ChatStore.init();
ChatStore.load(chatEl);
renderHistoryList();

// SEND
async function send(){
  const text = input.value.trim();
  if(!text) return;

  addUserBubble(text);
  ChatStore.add("user", text);
  input.value="";

  const res = await fetchTextResponse(text,"chat",ChatStore.history());
  typeWriter(res.text);
  ChatStore.add("assistant",res.text);
}

sendBtn.onclick = send;
input.addEventListener("keydown",e=>{
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault(); send();
  }
});

// MENU
hambBtn.onclick = ()=> menuOverlay.classList.add("open");
menuOverlay.onclick = e=>{
  if(e.target === menuOverlay) menuOverlay.classList.remove("open");
};

// NEW CHAT
newChatBtn.onclick = ()=>{
  ChatStore.newChat();
  ChatStore.load(chatEl);
  renderHistoryList();
  menuOverlay.classList.remove("open");
};

// HISTORY LIST
function renderHistoryList(){
  historyList.innerHTML="";
  ChatStore.list().forEach(c=>{
    const row=document.createElement("div");
    row.className="history-row";
    row.innerHTML=`
      <span>${c.title}</span>
      <button class="del">ğŸ—‘ï¸</button>
    `;
    row.onclick=()=>{
      ChatStore.currentId=c.id;
      ChatStore.load(chatEl);
      menuOverlay.classList.remove("open");
    };
    row.querySelector(".del").onclick=(e)=>{
      e.stopPropagation();
      ChatStore.deleteChat(c.id);
      renderHistoryList();
    };
    historyList.appendChild(row);
  });
}
</script>

</body>
</html>
